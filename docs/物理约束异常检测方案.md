# åŸºäºç‰©ç†çº¦æŸçš„å¼‚å¸¸å€¼æ£€æµ‹æ–¹æ¡ˆ

## ğŸ“‹ èƒŒæ™¯ä¸é—®é¢˜

### åŸæœ‰æ–¹æ¡ˆçš„å±€é™æ€§

ä¹‹å‰é‡‡ç”¨çš„ **IQRï¼ˆå››åˆ†ä½è·ï¼‰ç»Ÿè®¡æ–¹æ³•** å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **è¯¯åˆ¤æ­£å¸¸å³°å€¼**ï¼š989 W/mÂ² çš„è¾ç…§åº¦ï¼ˆæ­£å¸¸æ™´å¤©å€¼ï¼‰è¢«æ ‡è®°ä¸ºå¼‚å¸¸
2. **è¯¯åˆ¤è£…æœºå®¹é‡é™„è¿‘çš„åŠŸç‡**ï¼š48MWï¼ˆæ¥è¿‘50MWè£…æœºå®¹é‡ï¼‰è¢«æ ‡è®°ä¸ºå¼‚å¸¸
3. **å¿½è§†ç‰©ç†è§„å¾‹**ï¼šæ¹¿åº¦100%ï¼ˆç‰©ç†åˆç†çš„æç«¯å€¼ï¼‰è¢«æ ‡è®°ä¸ºå¼‚å¸¸
4. **ç¼ºä¹é¢†åŸŸçŸ¥è¯†**ï¼šçº¯ç»Ÿè®¡æ–¹æ³•æ— æ³•ç†è§£å…‰ä¼ç³»ç»Ÿçš„ç‰©ç†ç‰¹æ€§

### æ ¸å¿ƒé—®é¢˜

> **å…‰ä¼æ•°æ®éµå¾ªæ˜ç¡®çš„ç‰©ç†è§„å¾‹ï¼Œä¸åº”ç”¨çº¯ç»Ÿè®¡æ–¹æ³•åˆ¤æ–­å¼‚å¸¸**

---

## ğŸ¯ æ”¹è¿›æ–¹æ¡ˆï¼šä¸‰å±‚å¼‚å¸¸æ£€æµ‹ä½“ç³»

### æ–¹æ¡ˆæ¶æ„

```
å¼‚å¸¸å€¼æ£€æµ‹ç³»ç»Ÿ
â”œâ”€â”€ ç¬¬ä¸€å±‚ï¼šé”™è¯¯æ ‡è®°æ£€æµ‹
â”‚   â””â”€â”€ è¯†åˆ«æ˜ç¡®çš„ç¼ºå¤±å€¼æ ‡è®°ï¼ˆ-99, -999, -9999ï¼‰
â”œâ”€â”€ ç¬¬äºŒå±‚ï¼šç‰©ç†çº¦æŸæ£€æµ‹
â”‚   â”œâ”€â”€ power: [0, 55000] kW
â”‚   â”œâ”€â”€ irradiance: [0, 1200] W/mÂ²
â”‚   â”œâ”€â”€ temperature: [-40, 60] Â°C
â”‚   â”œâ”€â”€ pressure: [850, 1100] hPa
â”‚   â””â”€â”€ humidity: [0, 100] %
â””â”€â”€ ç¬¬ä¸‰å±‚ï¼šç»Ÿè®¡æ–¹æ³•ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ IQRï¼šç”¨äºéç‰©ç†æ•°æ®
    â””â”€â”€ Z-scoreï¼šç”¨äºéç‰©ç†æ•°æ®
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. é…ç½®æ–‡ä»¶æ›´æ–° (`config/data_config.yaml`)

```yaml
preprocessing:
  outlier_detection:
    method: "physical"         # æ£€æµ‹æ–¹æ³•ï¼šphysical/iqr/zscore
    apply_to: ["power", "irradiance", "temperature", "pressure", "humidity"]
    
    # ç‰©ç†çº¦æŸèŒƒå›´ï¼ˆåŸºäºé¢†åŸŸçŸ¥è¯†ï¼‰
    physical_ranges:
      power: [0, 55000]        # kWï¼Œè£…æœºå®¹é‡50MW + 10%è¿‡è½½ä¿æŠ¤
      irradiance: [0, 1200]    # W/mÂ²ï¼Œåœ°é¢å¤ªé˜³è¾ç…§åº¦ç‰©ç†ä¸Šé™
      temperature: [-40, 60]   # Â°Cï¼Œæç«¯æ°”å€™èŒƒå›´
      pressure: [850, 1100]    # hPaï¼Œè€ƒè™‘æµ·æ‹”1500mçš„æ°”å‹èŒƒå›´
      humidity: [0, 100]       # %ï¼Œç›¸å¯¹æ¹¿åº¦çš„ç‰©ç†èŒƒå›´
    
    # é”™è¯¯æ ‡è®°å€¼ï¼ˆå°†è¢«è§†ä¸ºç¼ºå¤±å€¼ï¼‰
    error_markers: [-99, -999, -9999]
```

### 2. ç‰©ç†èŒƒå›´çš„ç§‘å­¦ä¾æ®

| å˜é‡ | èŒƒå›´ | ä¾æ® |
|------|------|------|
| **power** | [0, 55000] kW | è£…æœºå®¹é‡50MW + 10%è¿‡è½½ä¿æŠ¤ |
| **irradiance** | [0, 1200] W/mÂ² | åœ°é¢è¾ç…§åº¦ç†è®ºä¸Šé™ï¼ˆæ ‡å‡†å¤§æ°”è´¨é‡ï¼Œæ™´æœ—å¤©ç©ºï¼‰ |
| **temperature** | [-40, 60] Â°C | ä¸­å›½æ°”å€™æå€¼èŒƒå›´ï¼ˆå«ç”˜è‚ƒåœ°åŒºï¼‰ |
| **pressure** | [850, 1100] hPa | æµ·æ‹”1500må¯¹åº”çš„æ°”å‹èŒƒå›´ |
| **humidity** | [0, 100] % | ç›¸å¯¹æ¹¿åº¦çš„ç‰©ç†å®šä¹‰èŒƒå›´ |

### 3. æ ¸å¿ƒä»£ç å®ç° (`src/data_processing/data_loader.py`)

#### ç‰©ç†çº¦æŸæ£€æµ‹é€»è¾‘

```python
def _detect_outliers(self, series: pd.Series, method: str = 'physical') -> Dict[str, Any]:
    """
    åŸºäºç‰©ç†çº¦æŸçš„å¼‚å¸¸æ£€æµ‹
    
    æ£€æµ‹ç­–ç•¥ï¼š
    1. ä¼˜å…ˆæ£€æµ‹é”™è¯¯æ ‡è®°å€¼ï¼ˆ-99, -999, -9999ï¼‰
    2. æ£€æµ‹è¶…å‡ºç‰©ç†èŒƒå›´çš„å€¼
    3. åˆ†ç±»ç»Ÿè®¡ï¼šé”™è¯¯æ ‡è®°æ•°é‡ vs èŒƒå›´è¿è§„æ•°é‡
    """
    if method == 'physical':
        # ç¬¬ä¸€å±‚ï¼šé”™è¯¯æ ‡è®°æ£€æµ‹
        error_markers = self.config.get('error_markers', [-99, -999, -9999])
        error_mask = series.isin(error_markers)
        
        # ç¬¬äºŒå±‚ï¼šç‰©ç†èŒƒå›´æ£€æµ‹
        physical_ranges = self.config.get('physical_ranges', {})
        column_name = series.name
        
        if column_name in physical_ranges:
            lower_bound, upper_bound = physical_ranges[column_name]
            range_mask = (series < lower_bound) | (series > upper_bound)
            outlier_mask = error_mask | range_mask
        else:
            # æœªå®šä¹‰ç‰©ç†èŒƒå›´çš„å˜é‡ï¼Œä»…æ£€æµ‹é”™è¯¯æ ‡è®°
            outlier_mask = error_mask
        
        return {
            'indices': series[outlier_mask].index,
            'count': outlier_mask.sum(),
            'error_marker_count': error_mask.sum(),
            'range_violation_count': range_mask.sum(),
            'method': 'physical_constraint',
            'bounds': [lower_bound, upper_bound]
        }
```

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

### æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | IQRç»Ÿè®¡æ–¹æ³• | ç‰©ç†çº¦æŸæ–¹æ³• |
|------|-------------|--------------|
| **ç†è®ºåŸºç¡€** | ç»Ÿè®¡åˆ†å¸ƒ | ç‰©ç†å®šå¾‹ + é¢†åŸŸçŸ¥è¯† |
| **é€‚ç”¨åœºæ™¯** | éç‰©ç†æ•°æ® | å…‰ä¼ã€æ°”è±¡ç­‰ç‰©ç†æ•°æ® |
| **è¯¯åˆ¤é£é™©** | é«˜ï¼ˆå³°å€¼æ˜“è¯¯åˆ¤ï¼‰ | ä½ï¼ˆåŸºäºç‰©ç†çœŸå®æ€§ï¼‰ |
| **å¯è§£é‡Šæ€§** | å¼±ï¼ˆç»Ÿè®¡æ¦‚å¿µï¼‰ | å¼ºï¼ˆç‰©ç†æ„ä¹‰æ˜ç¡®ï¼‰ |
| **å‚æ•°è®¾ç½®** | éœ€è°ƒå‚ï¼ˆé˜ˆå€¼æ•æ„Ÿï¼‰ | å›ºå®šï¼ˆåŸºäºç‰©ç†å®šå¾‹ï¼‰ |

### å®é™…æ•ˆæœä¸¾ä¾‹

| æ•°å€¼ | IQRæ–¹æ³• | ç‰©ç†çº¦æŸæ–¹æ³• | è¯´æ˜ |
|------|---------|--------------|------|
| è¾ç…§åº¦ 989 W/mÂ² | âŒ å¼‚å¸¸ | âœ… æ­£å¸¸ | æ™´å¤©å³°å€¼ï¼Œç¬¦åˆç‰©ç†è§„å¾‹ |
| åŠŸç‡ 48000 kW | âŒ å¼‚å¸¸ | âœ… æ­£å¸¸ | æ¥è¿‘è£…æœºå®¹é‡ï¼Œåˆç† |
| æ¹¿åº¦ 100% | âŒ å¼‚å¸¸ | âœ… æ­£å¸¸ | é¥±å’ŒçŠ¶æ€ï¼Œç‰©ç†å¯èƒ½ |
| è¾ç…§åº¦ 1500 W/mÂ² | âœ… æ­£å¸¸ | âŒ å¼‚å¸¸ | è¶…è¿‡åœ°é¢ç‰©ç†ä¸Šé™ |
| åŠŸç‡ -99 kW | âš ï¸ å¼‚å¸¸ | âŒ é”™è¯¯æ ‡è®° | æ˜ç¡®çš„ç¼ºå¤±å€¼æ ‡è®° |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. å¯ç”¨ç‰©ç†çº¦æŸæ£€æµ‹

åœ¨ `config/data_config.yaml` ä¸­è®¾ç½®ï¼š

```yaml
preprocessing:
  outlier_detection:
    method: "physical"  # ä½¿ç”¨ç‰©ç†çº¦æŸæ–¹æ³•
```

### 2. è‡ªå®šä¹‰ç‰©ç†èŒƒå›´

æ ¹æ®å…·ä½“ç«™ç‚¹è°ƒæ•´èŒƒå›´ï¼š

```yaml
physical_ranges:
  power: [0, 110000]      # é’ˆå¯¹100MWè£…æœºå®¹é‡çš„ç«™ç‚¹
  irradiance: [0, 1200]   # ä¿æŒæ ‡å‡†ä¸Šé™
  temperature: [-20, 50]  # é’ˆå¯¹æ¸©å¸¦åœ°åŒº
```

### 3. åˆ‡æ¢å›ç»Ÿè®¡æ–¹æ³•ï¼ˆä¸æ¨èï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•ï¼š

```yaml
preprocessing:
  outlier_detection:
    method: "iqr"        # æˆ– "zscore"
    iqr_threshold: 1.5
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### 1. æ•°æ®è´¨é‡æå‡

- **å‡å°‘è¯¯åˆ¤**ï¼šæ­£å¸¸å³°å€¼ä¸å†è¢«æ ‡è®°ä¸ºå¼‚å¸¸
- **ä¿ç•™æœ‰æ•ˆæ•°æ®**ï¼šæ›´å¤šç‰©ç†åˆç†çš„æ•°æ®ç”¨äºè®­ç»ƒ
- **æé«˜æ¨¡å‹æ€§èƒ½**ï¼šè®­ç»ƒæ•°æ®æ›´ç¬¦åˆçœŸå®åˆ†å¸ƒ

### 2. å¯è§£é‡Šæ€§å¢å¼º

- **ç‰©ç†æ„ä¹‰æ˜ç¡®**ï¼šæ¯ä¸ªé˜ˆå€¼éƒ½æœ‰ç‰©ç†ä¾æ®
- **æ˜“äºå®¡æŸ¥**ï¼šé¢†åŸŸä¸“å®¶å¯ç›´æ¥éªŒè¯èŒƒå›´åˆç†æ€§
- **ä¾¿äºè°ƒè¯•**ï¼šå¼‚å¸¸æ•°æ®çš„åŸå› æ¸…æ™°å¯è¿½æº¯

### 3. ç³»ç»Ÿé²æ£’æ€§

- **è‡ªé€‚åº”ä¸åŒç«™ç‚¹**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»è°ƒæ•´
- **å…¼å®¹æœªæ¥æ‰©å±•**ï¼šä¿ç•™ç»Ÿè®¡æ–¹æ³•ä½œä¸ºå¤‡é€‰
- **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰ä»£ç çš„å…¶ä»–éƒ¨åˆ†

---

## ğŸ” éªŒè¯æ–¹æ³•

### æ•°æ®è´¨é‡æŠ¥å‘Šç¤ºä¾‹

```
å¼‚å¸¸å€¼æ£€æµ‹æŠ¥å‘Šï¼ˆç‰©ç†çº¦æŸæ–¹æ³•ï¼‰
================================
å˜é‡: power
æ–¹æ³•: physical_constraint
ç‰©ç†èŒƒå›´: [0, 55000] kW
--------------------------------
æ€»æ ·æœ¬æ•°: 70,080
æ£€æµ‹åˆ°å¼‚å¸¸: 12 (0.02%)
  - é”™è¯¯æ ‡è®°: 8 (-99æ ‡è®°)
  - èŒƒå›´è¿è§„: 4 (>55000 kW)
--------------------------------
å¼‚å¸¸æ ·æœ¬é¢„è§ˆ:
  2023-01-05 03:00 â†’ -99 kW (é”™è¯¯æ ‡è®°)
  2023-03-12 12:15 â†’ 56,200 kW (è¶…è¿‡è£…æœºå®¹é‡)
```

---

## ğŸ“ ç»´æŠ¤å»ºè®®

1. **å®šæœŸå®¡æŸ¥ç‰©ç†èŒƒå›´**ï¼šç»“åˆç«™ç‚¹å®é™…è¿è¡Œæ•°æ®è°ƒæ•´
2. **è®°å½•å¼‚å¸¸æ¡ˆä¾‹**ï¼šåˆ†æè¢«æ ‡è®°çš„å¼‚å¸¸å€¼æ˜¯å¦åˆç†
3. **ä¸é¢†åŸŸä¸“å®¶æ²Ÿé€š**ï¼šç¡®ä¿ç‰©ç†çº¦æŸç¬¦åˆæœ€æ–°å·¥ç¨‹å®è·µ
4. **ç›‘æ§æ•°æ®åˆ†å¸ƒ**ï¼šè§‚å¯Ÿåˆ é™¤å¼‚å¸¸åçš„æ•°æ®åˆ†å¸ƒå˜åŒ–

---

## ğŸ“ å‚è€ƒæ–‡çŒ®

1. **å¤ªé˜³è¾ç…§åº¦æ ‡å‡†**ï¼šASTM G173-03 Standard Tables for Reference Solar Spectral Irradiances
2. **å…‰ä¼ç³»ç»Ÿè®¾è®¡**ï¼šIEC 61724-1:2017 Photovoltaic system performance monitoring
3. **æ°”è±¡æ•°æ®æ ‡å‡†**ï¼šWMO Technical Regulations (World Meteorological Organization)

---

## ğŸ“Œ æ€»ç»“

âœ… **æ ¸å¿ƒæ”¹è¿›**ï¼šä»ç»Ÿè®¡é©±åŠ¨è½¬å‘é¢†åŸŸçŸ¥è¯†é©±åŠ¨  
âœ… **å…³é”®ä¼˜åŠ¿**ï¼šå‡å°‘è¯¯åˆ¤ï¼Œæé«˜æ•°æ®åˆ©ç”¨ç‡  
âœ… **å®æ–½ç®€å•**ï¼šé…ç½®æ–‡ä»¶å³å¯åˆ‡æ¢æ–¹æ³•  
âœ… **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰ç»Ÿè®¡æ–¹æ³•ä½œä¸ºå¤‡é€‰  

> **å»ºè®®**ï¼šå¯¹äºæ‰€æœ‰æ¶‰åŠç‰©ç†æµ‹é‡çš„æ•°æ®ï¼ˆæ°”è±¡ã€èƒ½æºã€å·¥ä¸šä¼ æ„Ÿå™¨ç­‰ï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨ç‰©ç†çº¦æŸæ–¹æ³•è¿›è¡Œå¼‚å¸¸æ£€æµ‹ã€‚

